<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	<resultMap id="AdminVO" type="kr.co.realty.data.admin.vo.AdminVO">
		<result property = "admSeq"                    column="ADM_SEQ" />
		<result property = "admID"	                  column="ADM_ID" />
		<result property = "admPW"                     column="ADM_PW" />
		<result property = "admName"                 column="ADM_NAME" />
		<result property = "email"                       column="EMAIL" />
		<result property = "departmentName"       column="DEPARTMENT_NAME" />
		<result property = "telnum"                     column="TELNUM" />
		<result property = "mobilenum"                column="MOBILENUM" />
		<result property = "isUse"                      column="IS_USE" />
		<result property = "regDate"                    column="REG_DATE" />
	</resultMap>
	
	<select id="selectOneForLogin"  parameterType="AdminVO" resultMap="AdminVO">	
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,DAMO.SCPDECB64('SCPKMAIL', EMAIL) AS EMAIL
			,DEPARTMENT_NAME
			,DAMO.SCPDECB64('SCPKTELNO', TELNUM) AS TELNUM
			,DAMO.SCPDECB64('SCPKHPNO', MOBILENUM) AS MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
		FROM HPCDTA.ADM_MEMBER
		WHERE IS_USE='Y'
		AND ADM_ID=#{admID}
	</select>
	
	<select id="selectOneForAdmin"  parameterType="AdminVO" resultMap="AdminVO">	
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,DAMO.SCPDECB64('SCPKMAIL', EMAIL) AS EMAIL
			,DEPARTMENT_NAME
			,DAMO.SCPDECB64('SCPKTELNO', TELNUM) AS TELNUM
			,DAMO.SCPDECB64('SCPKHPNO', MOBILENUM) AS MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
		FROM HPCDTA.ADM_MEMBER
		WHERE ADM_ID=#{admID}
	</select>
	
	<select id="selectCountListForAdmin"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(ADM_ID)
		FROM HPCDTA.ADM_MEMBER WHERE 1=1
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (ADM_ID LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%' OR ADM_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
			<if test="searchType == 'num'">
				AND (ADM_ID LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>	
			<if test="searchType == 'name'">
				AND (ADM_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
			<if test="searchType == 'team'">
				AND (DEPARTMENT_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
		</if>
	</select>
	<select id="selectListForAdmin"  parameterType="SearchVO" resultMap="AdminVO">	
		SELECT * FROM (
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,DAMO.SCPDECB64('SCPKMAIL', EMAIL) AS EMAIL
			,DEPARTMENT_NAME
			,DAMO.SCPDECB64('SCPKTELNO', TELNUM) AS TELNUM
			,DAMO.SCPDECB64('SCPKHPNO', MOBILENUM) AS MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
			,ROW_NUMBER() OVER( ORDER BY REG_DATE DESC, ADM_ID DESC) AS RNUM
		FROM HPCDTA.ADM_MEMBER WHERE 1=1
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (ADM_ID LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%' OR ADM_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
			<if test="searchType == 'num'">
				AND (ADM_ID LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>	
			<if test="searchType == 'name'">
				AND (ADM_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
			<if test="searchType == 'team'">
				AND (DEPARTMENT_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
			</if>
		</if>
		)T WHERE 
			RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
		
	</select>
	<insert id="insertAdminMember" parameterType="AdminVO">
		INSERT INTO
			HPCDTA.ADM_MEMBER
		(
		ADM_SEQ
		,ADM_ID
		,ADM_PW
		,ADM_NAME
		,EMAIL
		,DEPARTMENT_NAME
		,TELNUM
		,MOBILENUM
		,IS_USE
		,AUTHORITY
		,REG_DATE
		)
		VALUES (
		NEXTVAL FOR HPCDTA.ADM_MEMBER_SEQ
		, #{admID}
		, #{admPW}
		, #{admName}
		, DAMO.SCPENCB64('SCPKMAIL', CAST(#{email} AS VARCHAR(100)))
		, #{departmentName}
		, DAMO.SCPENCB64('SCPKTELNO',CAST(#{telnum} AS VARCHAR(50)))
		, DAMO.SCPENCB64('SCPKHPNO',CAST(#{mobilenum} AS VARCHAR(50)))
		, #{isUse}
		, 'ROLE_ADMIN'
		, CURRENT TIMESTAMP
		)
	</insert>
	
	<update id="updateAdminMember" parameterType="AdminVO">
		UPDATE HPCDTA.ADM_MEMBER SET
			ADM_NAME = #{admName}
			<if test="admPW != null and admPW != ''">
			,ADM_PW = #{admPW}
			</if>
			,EMAIL = DAMO.SCPENCB64('SCPKMAIL', CAST(#{email} AS VARCHAR(100)))
			,DEPARTMENT_NAME = #{departmentName}
			,TELNUM = DAMO.SCPENCB64('SCPKTELNO', CAST(#{telnum} AS VARCHAR(50)))
			,MOBILENUM = DAMO.SCPENCB64('SCPKHPNO', CAST(#{mobilenum} AS VARCHAR(50)))
			,IS_USE = #{isUse}
		WHERE 
			ADM_ID = #{admID}
	</update>
	
	<delete id="deleteOneForAdmin" parameterType="AdminVO">
		DELETE FROM HPCDTA.ADM_MEMBER WHERE ADM_ID=#{admID}
	</delete>
	
</mapper>