<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="building">
	<resultMap id="BLDCodeVO" type="kr.co.realty.data.building.vo.BLDCodeVO">
		<result property = "bldCodeSeq"		column="BLD_CODE_SEQ"/>
		<result property = "codeName"		column="CODE_NAME"/>
		<result property = "pBldCodeSeq"	column="P_BLD_CODE_SEQ"/>
		<result property = "codeText"		column="CODE_TEXT"/>
		<result property = "isUse"				column="IS_USE"/>
	</resultMap>
	
	<resultMap id="BuildingVO" type="kr.co.realty.data.building.vo.BuildingVO">
		<result property = "bldInfoSeq"		column="BLD_INFO_SEQ" />
		<result property = "bldZone"			column="BLD_ZONE" />
		<result property = "bldDivision"		column="BLD_DIVISION" />
		<result property = "bldFlagMg"		column="BLD_FLAG_MG" />
		<result property = "bldFlagCu"		column="BLD_FLAG_CU" />
		<result property = "bldName"			column="BLD_NAME" />
		<result property = "bldAddr"			column="BLD_ADDR" />
		<result property = "bldManager"		column="BLD_MANAGER" />
		<result property = "bldTelnum"		column="BLD_TELNUM" />
		<result property = "bldScale"			column="BLD_SCALE" />
		<result property = "bldParking"		column="BLD_PARKING" />
		<result property = "bldArea"			column="BLD_AREA" />
		<result property = "bldRate"			column="BLD_RATE" />
		<result property = "bldCompletion"	column="BLD_COMPLETION" />
		<result property = "bldCeiling"			column="BLD_CEILING" />
		<result property = "bldEv"				column="BLD_EV" />
		<result property = "bldTypicalFloor"	column="BLD_TYPICAL_FLOOR" />
		<result property = "bldParkInfo"		column="BLD_PARK_INFO" />
		<result property = "bldContents"		column="BLD_CONTENTS" />
		<result property = "bldLocaleX"		column="BLD_LOCALE_X" />
		<result property = "bldLocaleY"		column="BLD_LOCALE_Y" />
		<result property = "regDate"			column="REG_DATE" />
		<result property = "regID"				column="REG_ID" />
		<result property = "bldZoneName"	column="BLD_ZONE_NAME" />
		<result property = "bldDivisionName"	column="BLD_DIVISION_NAME" />
		<result property = "fileSavenm"		column="FILE_SAVENM"/>
		<result property = "filePath"			column="FILE_PATH"/>		
	</resultMap>
	
	<resultMap id="BuildingFileVO" type="kr.co.realty.data.building.vo.BuildingFileVO">
		<result property = "bldInfoFileSeq"	column="BLD_INFO_FILE_SEQ"/>
		<result property = "bldInfoSeq"		column="BLD_INFO_SEQ"/>
		<result property = "fileType"			column="FILE_TYPE"/>
		<result property = "fileOrgnm"		column="FILE_ORGNM"/>
		<result property = "fileSavenm"		column="FILE_SAVENM"/>
		<result property = "filePath"			column="FILE_PATH"/>
		<result property = "fileSize"			column="FILE_SIZE"/>
		<result property = "fileFormName"	column="FILE_FORM_NAME"/>
	</resultMap>
	
	
	
	<select id="selectListForBLDCode"  parameterType="BLDCodeVO" resultMap="BLDCodeVO">	
		SELECT
			BLD_CODE_SEQ
			,CODE_NAME
			,P_BLD_CODE_SEQ
			,CODE_TEXT
			,IS_USE
		FROM HPCDTA.BLD_CODE
		WHERE IS_USE='Y'
		AND P_BLD_CODE_SEQ=#{bldCodeSeq,jdbcType=INTEGER}
	</select>
	
	<select id="selectOneForBLDCode"  parameterType="BLDCodeVO" resultMap="BLDCodeVO">	
		SELECT
			BLD_CODE_SEQ
			,CODE_NAME
			,P_BLD_CODE_SEQ
			,CODE_TEXT
			,IS_USE
		FROM HPCDTA.BLD_CODE
		WHERE IS_USE='Y'
		AND BLD_CODE_SEQ=#{bldCodeSeq,jdbcType=INTEGER}
	</select>
	
	
	<select id="selectListForBuildingCombo"  parameterType="SearchVO" resultMap="BLDCodeVO">
		SELECT 
			BLD_INFO_SEQ AS BLD_CODE_SEQ
			, BLD_NAME AS CODE_NAME
			FROM HPCDTA.BLD_INFO
		WHERE 
			<if test=' bldZone == "" '>
					BLD_ZONE = 0
			</if>
			<if test=' bldZone != "" '>
					BLD_ZONE = #{bldZone,jdbcType=INTEGER}
			</if>
			<if test=' bldDivision == "" '>
					AND BLD_DIVISION = 0
			</if>
			<if test=' bldDivision != "" '>
					AND BLD_DIVISION = #{bldDivision,jdbcType=INTEGER}
			</if>			
			
			<if test=' bldFlagMg == "Y" '>
				AND BLD_FLAG_MG = 'Y'
			</if>
			<if test=' bldFlagCu == "Y" '>
				AND BLD_FLAG_CU = 'Y'
			</if>
	</select>
	
	<select id="selectListForManagerBuildingCombo"  parameterType="SearchVO" resultMap="BLDCodeVO">
		SELECT 
			T1.BLD_INFO_SEQ AS BLD_CODE_SEQ
			, T1.BLD_NAME AS CODE_NAME
			FROM HPCDTA.BLD_INFO T1
			LEFT OUTER JOIN HPCDTA.BLD_MANAGER T2 ON T1.BLD_INFO_SEQ <![CDATA[=]]> T2.BLD_INFO_SEQ
		WHERE T2.BLD_MANAGER_SEQ IS NULL
			AND T1.BLD_ZONE = #{bldZone,jdbcType=INTEGER}
			AND T1.BLD_DIVISION = #{bldDivision,jdbcType=INTEGER}
	</select>
	
	 <insert id="insertBuildingInfo" parameterType="BuildingVO" useGeneratedKeys="true" keyProperty="BLD_INFO_SEQ">
     	<selectKey keyProperty="bldInfoSeq" resultType="int" order="BEFORE">
			SELECT NEXTVAL FOR HPCDTA.BLD_INFO_T_SEQ FROM SYSIBM.SYSDUMMY1
		</selectKey> 
          INSERT INTO 
          	HPCDTA.BLD_INFO ( 
			BLD_INFO_SEQ
			,BLD_ZONE
			,BLD_DIVISION
			,BLD_FLAG_MG
			,BLD_FLAG_CU
			,BLD_NAME
			,BLD_ADDR
			,BLD_MANAGER
			,BLD_TELNUM
			,BLD_SCALE
			,BLD_PARKING
			,BLD_AREA
			,BLD_RATE
			,BLD_COMPLETION
			,BLD_CEILING
			,BLD_EV
			,BLD_TYPICAL_FLOOR
			,BLD_PARK_INFO
			,BLD_CONTENTS
			,BLD_LOCALE_X
			,BLD_LOCALE_Y
			,REG_DATE
			,REG_ID
          ) VALUES ( 
                #{bldInfoSeq,jdbcType=INTEGER}
				,#{bldZone,jdbcType=INTEGER}
				,#{bldDivision,jdbcType=INTEGER}
				,#{bldFlagMg,jdbcType=VARCHAR}
				,#{bldFlagCu,jdbcType=VARCHAR}
				,#{bldName,jdbcType=VARCHAR}
				,#{bldAddr,jdbcType=VARCHAR}
				,#{bldManager,jdbcType=VARCHAR}
				,#{bldTelnum,jdbcType=VARCHAR}
				,#{bldScale,jdbcType=VARCHAR}
				,#{bldParking,jdbcType=VARCHAR}
				,#{bldArea,jdbcType=VARCHAR}
				,#{bldRate,jdbcType=VARCHAR}
				,#{bldCompletion,jdbcType=VARCHAR}
				,#{bldCeiling,jdbcType=VARCHAR}
				,#{bldEv,jdbcType=VARCHAR}
				,#{bldTypicalFloor,jdbcType=VARCHAR}
				,#{bldParkInfo,jdbcType=VARCHAR}
				,#{bldContents,jdbcType=VARCHAR}
				,#{bldLocaleX,jdbcType=VARCHAR}
				,#{bldLocaleY,jdbcType=VARCHAR}
				,CURRENT TIMESTAMP
				,#{regID}
          ) 
    </insert>
    
	 <update id="updatetBuildingInfo" parameterType="BuildingVO">
     	
		UPDATE HPCDTA.BLD_INFO SET
			BLD_ZONE=#{bldZone,jdbcType=INTEGER}
			,BLD_DIVISION=#{bldDivision,jdbcType=INTEGER}
			,BLD_FLAG_MG=#{bldFlagMg,jdbcType=VARCHAR}
			,BLD_FLAG_CU=#{bldFlagCu,jdbcType=VARCHAR}
			,BLD_NAME=#{bldName,jdbcType=VARCHAR}
			,BLD_ADDR=#{bldAddr,jdbcType=VARCHAR}
			,BLD_MANAGER=#{bldManager,jdbcType=VARCHAR}
			,BLD_TELNUM=#{bldTelnum,jdbcType=VARCHAR}
			,BLD_SCALE=#{bldScale,jdbcType=VARCHAR}
			,BLD_PARKING=#{bldParking,jdbcType=VARCHAR}
			,BLD_AREA=#{bldArea,jdbcType=VARCHAR}
			,BLD_RATE=#{bldRate,jdbcType=VARCHAR}
			,BLD_COMPLETION=#{bldCompletion,jdbcType=VARCHAR}
			,BLD_CEILING=#{bldCeiling,jdbcType=VARCHAR}
			,BLD_EV=#{bldEv,jdbcType=VARCHAR}
			,BLD_TYPICAL_FLOOR=#{bldTypicalFloor,jdbcType=VARCHAR}
			,BLD_PARK_INFO=#{bldParkInfo,jdbcType=VARCHAR}
			,BLD_CONTENTS=#{bldContents,jdbcType=VARCHAR}
			,BLD_LOCALE_X=#{bldLocaleX,jdbcType=VARCHAR}
			,BLD_LOCALE_Y=#{bldLocaleY,jdbcType=VARCHAR}
		WHERE BLD_INFO_SEQ = #{bldInfoSeq,jdbcType=INTEGER}
    </update>
    
	 <insert id="insertBuildingInfoFile" parameterType="BuildingFileVO">     	
          INSERT INTO 
          	HPCDTA.BLD_INFO_FILE ( 
				BLD_INFO_FILE_SEQ
				,BLD_INFO_SEQ
				,FILE_TYPE
				,FILE_ORGNM
				,FILE_SAVENM
				,FILE_PATH
				,FILE_SIZE
				,FILE_FORM_NAME
          ) VALUES ( 
				NEXTVAL FOR HPCDTA.BLD_INFO_FILE_T_SEQ
				,#{bldInfoSeq,jdbcType=INTEGER}
				,#{fileType,jdbcType=VARCHAR}
				,#{fileOrgnm,jdbcType=VARCHAR}
				,#{fileSavenm,jdbcType=VARCHAR}
				,#{filePath,jdbcType=VARCHAR}
				,#{fileSize,jdbcType=VARCHAR}
				,#{fileFormName,jdbcType=VARCHAR}
          ) 
    </insert>

	<select id="selectCountListForBuilding"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(BLD_INFO_SEQ)			
		FROM HPCDTA.BLD_INFO
		WHERE 1=1
		<if test=" bldZone != null and bldZone != '' ">
			AND BLD_ZONE = #{bldZone,jdbcType=INTEGER}
		</if>
		<if test=" bldDivision != null and bldDivision != '' ">
			AND BLD_DIVISION = #{bldDivision,jdbcType=INTEGER}
		</if>
		<if test=" bldInfoSeq != null and bldInfoSeq != '' ">
			AND BLD_INFO_SEQ = #{bldInfoSeq,jdbcType=INTEGER}
		</if>
		<if test=" searchText != null and searchText != '' ">
			AND (BLD_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
		</if>
		<if test=' bldFlagMg == "Y" '>
			AND BLD_FLAG_MG = 'Y'
		</if>
		<if test=' bldFlagCu == "Y" '>
			AND BLD_FLAG_CU = 'Y'
		</if>
	</select>
	
	<select id="selectListForBuilding"  parameterType="SearchVO" resultMap="BuildingVO">
	SELECT * FROM (	
		SELECT
			a.BLD_INFO_SEQ
			,a.BLD_ZONE
			,a.BLD_DIVISION
			,a.BLD_FLAG_MG
			,a.BLD_FLAG_CU
			,a.BLD_NAME
			,a.BLD_ADDR
			,a.BLD_MANAGER
			,a.BLD_TELNUM
			,a.BLD_SCALE
			,a.BLD_PARKING
			,a.BLD_AREA
			,a.BLD_RATE
			,a.BLD_COMPLETION
			,a.BLD_CEILING
			,a.BLD_EV
			,a.BLD_TYPICAL_FLOOR
			,a.BLD_PARK_INFO
			,a.BLD_CONTENTS
			,a.BLD_LOCALE_X
			,a.BLD_LOCALE_Y
			,a.REG_DATE
			,a.REG_ID
			,T1.CODE_NAME AS BLD_ZONE_NAME
			,T2.CODE_NAME AS BLD_DIVISION_NAME
			,T3.FILE_SAVENM
			,T3.FILE_PATH
			,ROW_NUMBER() OVER( ORDER BY a.REG_DATE DESC, a.BLD_INFO_SEQ DESC) AS RNUM
		FROM HPCDTA.BLD_INFO a
			LEFT OUTER JOIN HPCDTA.BLD_CODE T1 ON a.BLD_ZONE = T1.BLD_CODE_SEQ
			LEFT OUTER JOIN HPCDTA.BLD_CODE T2 ON a.BLD_DIVISION = T2.BLD_CODE_SEQ
			LEFT OUTER JOIN HPCDTA.BLD_INFO_FILE T3 ON a.BLD_INFO_SEQ = T3.BLD_INFO_SEQ
		WHERE 1=1
		<if test=" bldZone != null and bldZone != '' ">
			AND a.BLD_ZONE = #{bldZone,jdbcType=INTEGER}
		</if>
		<if test=" bldDivision != null and bldDivision != '' ">
			AND a.BLD_DIVISION = #{bldDivision,jdbcType=INTEGER}
		</if>
		<if test=" bldInfoSeq != null and bldInfoSeq != '' ">
			AND a.BLD_INFO_SEQ = #{bldInfoSeq,jdbcType=INTEGER}
		</if>
		<if test=" searchText != null and searchText != '' ">
			AND (a.BLD_NAME LIKE '%'||TRIM(CAST ((#{searchText}) AS VARCHAR(100) CCSID 1208))||'%')
		</if>
		<if test=' bldFlagMg == "Y" '>
			AND a.BLD_FLAG_MG = 'Y'
		</if>
		<if test=' bldFlagCu == "Y" '>
			AND a.BLD_FLAG_CU = 'Y'
		</if>
		)T WHERE 
				RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
	</select>
	
	<select id="selectOneForBuilding"  parameterType="BuildingVO" resultMap="BuildingVO">		
		SELECT
			a.BLD_INFO_SEQ
			,a.BLD_ZONE
			,a.BLD_DIVISION
			,a.BLD_FLAG_MG
			,a.BLD_FLAG_CU
			,a.BLD_NAME
			,a.BLD_ADDR
			,a.BLD_MANAGER
			,a.BLD_TELNUM
			,a.BLD_SCALE
			,a.BLD_PARKING
			,a.BLD_AREA
			,a.BLD_RATE
			,a.BLD_COMPLETION
			,a.BLD_CEILING
			,a.BLD_EV
			,a.BLD_TYPICAL_FLOOR
			,a.BLD_PARK_INFO
			,a.BLD_CONTENTS
			,a.BLD_LOCALE_X
			,a.BLD_LOCALE_Y
			,a.REG_DATE
			,a.REG_ID
			--,t1.CODE_NAME AS BLD_ZONE_NAME
			--,t2.CODE_NAME AS BLD_DIVISION_NAME
			,ROW_NUMBER() OVER( ORDER BY REG_DATE DESC, BLD_INFO_SEQ DESC) AS RNUM
		FROM HPCDTA.BLD_INFO a
			--LEFT OUTER JOIN BLD_CODE T1 ON a.BLD_ZONE = t1.BLD_CODE_SEQ
			--LEFT OUTER JOIN BLD_CODE T2 ON a.BLD_DIVISION = t2.BLD_CODE_SEQ
		WHERE 
			a.BLD_INFO_SEQ = #{bldInfoSeq}
		<if test=' bldFlagMg == "Y" '>
			AND a.BLD_FLAG_MG = 'Y'
		</if>
		<if test=' bldFlagCu == "Y" '>
			AND a.BLD_FLAG_CU = 'Y'
		</if>
	</select>
	
	<select id="selectOneForBuildingFile"  parameterType="BuildingFileVO" resultMap="BuildingFileVO">		
		SELECT		
			BLD_INFO_FILE_SEQ
			,BLD_INFO_SEQ
			,FILE_TYPE
			,FILE_ORGNM
			,FILE_SAVENM
			,FILE_PATH
			,FILE_SIZE
			,FILE_FORM_NAME
		FROM HPCDTA.BLD_INFO_FILE
		WHERE 
			BLD_INFO_SEQ = #{bldInfoSeq}
	</select>
	
	<delete id="deleteBuildingFile" parameterType="BuildingFileVO">     	
		DELETE FROM HPCDTA.BLD_INFO_FILE WHERE BLD_INFO_FILE_SEQ=#{bldInfoFileSeq}
    </delete>
    
    <delete id="deleteOneForBuilding" parameterType="BuildingVO">     	
		DELETE FROM HPCDTA.BLD_INFO WHERE BLD_INFO_SEQ = #{bldInfoSeq,jdbcType=INTEGER}
    </delete>
		
</mapper>