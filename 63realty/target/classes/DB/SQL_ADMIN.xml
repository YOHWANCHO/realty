<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	<resultMap id="AdminVO" type="kr.co.realty.data.admin.vo.AdminVO">
		<result property = "admSeq"                    column="ADM_SEQ" />
		<result property = "admID"	                  column="ADM_ID" />
		<result property = "admPW"                     column="ADM_PW" />
		<result property = "admName"                 column="ADM_NAME" />
		<result property = "email"                       column="EMAIL" />
		<result property = "departmentName"       column="DEPARTMENT_NAME" />
		<result property = "telnum"                     column="TELNUM" />
		<result property = "mobilenum"                column="MOBILENUM" />
		<result property = "isUse"                      column="IS_USE" />
		<result property = "regDate"                    column="REG_DATE" />
	</resultMap>
	
	<select id="selectOneForLogin"  parameterType="AdminVO" resultMap="AdminVO">	
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,EMAIL
			,DEPARTMENT_NAME
			,TELNUM
			,MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
		FROM ADM_MEMBER
		WHERE IS_USE='Y'
		AND ADM_ID=#{admID}
	</select>
	
	<select id="selectOneForAdmin"  parameterType="AdminVO" resultMap="AdminVO">	
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,EMAIL
			,DEPARTMENT_NAME
			,TELNUM
			,MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
		FROM ADM_MEMBER
		WHERE ADM_ID=#{admID}
	</select>
	
	<select id="selectCountListForAdmin"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(ADM_ID)
		FROM ADM_MEMBER WHERE 1=1
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (ADM_ID LIKE '%'||#{searchText}||'%' OR ADM_NAME LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 'num'">
				AND (ADM_ID LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 'name'">
				AND (ADM_NAME LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 'team'">
				AND (DEPARTMENT_NAME LIKE '%'||#{searchText}||'%')
			</if>
		</if>
	</select>
	<select id="selectListForAdmin"  parameterType="SearchVO" resultMap="AdminVO">	
		SELECT * FROM (
		SELECT
			ADM_SEQ
			,ADM_ID
			,ADM_PW
			,ADM_NAME
			,EMAIL
			,DEPARTMENT_NAME
			,TELNUM
			,MOBILENUM
			,IS_USE
			,AUTHORITY
			,REG_DATE
			,ROW_NUMBER() OVER( ORDER BY REG_DATE DESC, ADM_ID DESC) AS RNUM
		FROM ADM_MEMBER WHERE 1=1
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (ADM_ID LIKE '%'||#{searchText}||'%' OR ADM_NAME LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 'num'">
				AND (ADM_ID LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 'name'">
				AND (ADM_NAME LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 'team'">
				AND (DEPARTMENT_NAME LIKE '%'||#{searchText}||'%')
			</if>
		</if>
		)T WHERE 
			RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
		
	</select>
	<insert id="insertAdminMember" parameterType="AdminVO">
		INSERT INTO
			ADM_MEMBER
		(
		ADM_SEQ
		,ADM_ID
		,ADM_PW
		,ADM_NAME
		,EMAIL
		,DEPARTMENT_NAME
		,TELNUM
		,MOBILENUM
		,IS_USE
		,AUTHORITY
		,REG_DATE
		)
		VALUES (
		ADM_MEMBER_SEQ.nextval
		, #{admID}
		, #{admPW}
		, #{admName}
		, #{email}
		, #{departmentName}
		, #{telnum}
		, #{mobilenum}
		, #{isUse}
		, 'ROLE_ADMIN'
		, SYSDATE
		)
	</insert>
	
	<update id="updateAdminMember" parameterType="AdminVO">
		UPDATE ADM_MEMBER SET
			ADM_NAME = #{admName}
			<if test="admPW != null and admPW != ''">
			,ADM_PW = #{admPW}
			</if>
			,EMAIL = #{email}
			,DEPARTMENT_NAME = #{departmentName}
			,TELNUM = #{telnum}
			,MOBILENUM = #{mobilenum}
			,IS_USE = #{isUse}
		WHERE 
			ADM_ID = #{admID}
	</update>
	
	<delete id="deleteOneForAdmin" parameterType="AdminVO">
		DELETE FROM ADM_MEMBER WHERE ADM_ID=#{admID}
	</delete>
	
</mapper>