<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	<resultMap id="BoardVO" type="kr.co.realty.data.board.vo.BoardVO">
		<result property ="mainBoardSeq" 	column="MAIN_BOARD_SEQ" />
		<result property ="boardID" 			column="BOARD_ID" />
		<result property ="regID" 				column="REG_ID" />
		<result property ="regName" 			column="REG_NAME" />
		<result property ="hitCount" 			column="HIT_COUNT" />
		<result property ="title" 				column="TITLE" />
		<result property ="codeSeq" 			column="CODE_SEQ" />
		<result property ="showDate" 		column="SHOW_DATE" />
		<result property ="regDate" 			column="REG_DATE" />
		<result property ="contents" 			column="CONTENTS" />
		<result property ="isUse" 				column="IS_USE" />		

		<result property ="nextMainBoardSeq" 	column="NEXT_MAIN_BOARD_SEQ" />
		<result property ="nextTitle" 				column="NEXT_TITE" />
		<result property ="preMainBoardSeq" 	column="PRE_MAIN_BOARD_SEQ" />
		<result property ="preTitle" 				column="PRE_TITE" />
		
		<result property ="mainBoardFileSeq" 	column="MAIN_BOARD_FILE_SEQ" />
		<result property = "fileSavenm"			column="FILE_SAVENM"/>
		<result property = "filePath"				column="FILE_PATH"/>
		<result property = "codeName"			column="CODE_NAME"/>
	</resultMap>
		
	<resultMap id="BoardFileVO" type="kr.co.realty.data.board.vo.BoardFileVO">
		<result property = "mainBoardFileSeq"	column="MAIN_BOARD_FILE_SEQ"/>
		<result property = "mainBoardSeq"		column="MAIN_BOARD_SEQ"/>
		<result property = "fileType"				column="FILE_TYPE"/>
		<result property = "fileOrgnm"			column="FILE_ORGNM"/>
		<result property = "fileSavenm"			column="FILE_SAVENM"/>
		<result property = "filePath"				column="FILE_PATH"/>
		<result property = "fileSize"				column="FILE_SIZE"/>
		<result property = "fileFormName"		column="FILE_FORM_NAME"/>
	</resultMap>
	 

	<select id="selectCountListForBoard"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(MAIN_BOARD_SEQ)			
		FROM MAIN_BOARD 
		WHERE 1=1
		 
		 <if test="arrBoardID != null and arrBoardID != '' ">
			AND BOARD_ID IN
	        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
	            #{type}
	        </foreach>
		</if>
		<if test="boardID != null and boardID != '' ">
			AND BOARD_ID=#{boardID}
		</if>
		
		<if test="userFlag == 'USER'">
			AND IS_USE = 'Y'
		</if>
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (TITLE LIKE '%'||#{searchText}||'%' OR CONTENTS LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 's_title'">
				AND (TITLE LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 's_contents'">
				AND (CONTENTS LIKE '%'||#{searchText}||'%')
			</if>			
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
		</if>		
	</select>
	
	<select id="selectListForBoard"  parameterType="SearchVO" resultMap="BoardVO">
	SELECT * FROM (	
		SELECT
			T1.MAIN_BOARD_SEQ
	        ,T1.BOARD_ID
	        ,T1.REG_ID
	        ,T1.HIT_COUNT
	        ,T1.TITLE
	        ,T1.SHOW_DATE
	        ,T1.REG_DATE
	        ,T1.CONTENTS
	        ,T1.IS_USE
	        ,T2.MAIN_BOARD_FILE_SEQ
	        ,T2.FILE_SAVENM
	        ,T2.FILE_PATH
			,ROW_NUMBER() OVER( ORDER BY T1.SHOW_DATE DESC, T1.MAIN_BOARD_SEQ DESC) AS RNUM
		FROM MAIN_BOARD T1
			LEFT OUTER JOIN MAIN_BOARD_FILE T2
			ON T1.MAIN_BOARD_SEQ = T2.MAIN_BOARD_SEQ
		WHERE 1=1
		<if test="arrBoardID != null and arrBoardID != '' ">
			AND BOARD_ID IN
	        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
	            #{type}
	        </foreach>
		</if>
		<if test="boardID != null and boardID != '' ">
			AND BOARD_ID=#{boardID}
		</if>
		
		<if test="userFlag == 'USER'">
			AND T1.IS_USE = 'Y'
		</if>
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (T1.TITLE LIKE '%'||#{searchText}||'%' OR T1.CONTENTS LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 's_title'">
				AND (T1.TITLE LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 's_contents'">
				AND (T1.CONTENTS LIKE '%'||#{searchText}||'%')
			</if>			
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND T1.SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND T1.SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
		</if>
		)T WHERE 
				RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
	</select>
	
	
	<insert id="insertMainBoard" parameterType="BoardVO" useGeneratedKeys="true" keyProperty="MAIN_BOARD_SEQ">
     	<selectKey keyProperty="mainBoardSeq" resultType="int" order="BEFORE">
			SELECT MAIN_BOARD_T_SEQ.NEXTVAL FROM DUAL
		</selectKey> 
          INSERT INTO 
          	MAIN_BOARD ( 
				MAIN_BOARD_SEQ
				,BOARD_ID
				,REG_ID
				,HIT_COUNT
				,TITLE
				<if test="codeSeq != 0">
					,CODE_SEQ
				</if>				
				,SHOW_DATE				
				,REG_DATE
				,CONTENTS
				,IS_USE
          ) VALUES ( 
                #{mainBoardSeq,jdbcType=INTEGER}
				,#{boardID,jdbcType=INTEGER}
				,#{regID,jdbcType=VARCHAR}
				,0
				,#{title,jdbcType=VARCHAR}
				<if test="codeSeq != 0">
					,#{codeSeq,jdbcType=INTEGER}
				</if>
				,TO_DATE(#{showDate,jdbcType=DATE}, 'YYYY-MM-DD')				
				,SYSDATE
				,#{contents,jdbcType=CLOB}
				,#{isUse,jdbcType=VARCHAR}				
          ) 
    </insert>
    
    <update id="updateMainBoard" parameterType="BuildingVO">
		UPDATE MAIN_BOARD SET
			TITLE=#{title,jdbcType=VARCHAR}
			<if test="codeSeq != 0">
				,CODE_SEQ = #{codeSeq,jdbcType=INTEGER}
			</if>
			,SHOW_DATE=TO_DATE(#{showDate,jdbcType=DATE}, 'YYYY-MM-DD')			
			,CONTENTS=#{contents,jdbcType=CLOB}
			,IS_USE=#{isUse,jdbcType=VARCHAR}
		WHERE MAIN_BOARD_SEQ = #{mainBoardSeq,jdbcType=INTEGER}
    </update>
    
	<insert id="insertMainBoardFile" parameterType="BoardFileVO" >
          INSERT INTO 
          	MAIN_BOARD_FILE (
				MAIN_BOARD_FILE_SEQ
				,MAIN_BOARD_SEQ
				,FILE_TYPE
				,FILE_ORGNM
				,FILE_SAVENM
				,FILE_PATH
				,FILE_SIZE
				,FILE_FORM_NAME
          ) VALUES ( 
                MAIN_BOARD_FILE_T_SEQ.NEXTVAL
				,#{mainBoardSeq,jdbcType=INTEGER}
				,#{fileType,jdbcType=VARCHAR}								
				,#{fileOrgnm,jdbcType=VARCHAR}
				,#{fileSavenm,jdbcType=VARCHAR}
				,#{filePath,jdbcType=VARCHAR}
				,#{fileSize,jdbcType=VARCHAR}
				,#{fileFormName,jdbcType=VARCHAR}
          ) 
    </insert>    
	
	<select id="selectOneForMainBoard"  parameterType="BoardVO" resultMap="BoardVO">
		SELECT
			T1.MAIN_BOARD_SEQ
	        ,T1.BOARD_ID
	        ,T1.REG_ID
	        ,T1.HIT_COUNT
	        ,T1.TITLE
	        ,T1.SHOW_DATE
	        ,T1.REG_DATE
	        ,T1.CONTENTS
	        ,T1.IS_USE
	        ,T1.CODE_SEQ
	        ,T2.ADM_NAME AS REG_NAME       
		FROM MAIN_BOARD T1
		LEFT OUTER JOIN ADM_MEMBER T2 ON T1.REG_ID = T2.ADM_ID
		WHERE T1.MAIN_BOARD_SEQ=#{mainBoardSeq}
	</select>
	
	<select id="selectOneForMainBoardPreNext"  parameterType="SearchVO" resultMap="BoardVO">
		
	SELECT T1.NEXT_MAIN_BOARD_SEQ
				,T1.NEXT_TITE
				,T2.PRE_MAIN_BOARD_SEQ
				,T2.PRE_TITE
		FROM
		
		(SELECT MAIN_BOARD_SEQ AS NEXT_MAIN_BOARD_SEQ
			,TITLE AS NEXT_TITE
			,'A' AS TEMP_COLUMN
			FROM MAIN_BOARD WHERE MAIN_BOARD_SEQ =
		(		
		SELECT MAIN_BOARD_SEQ FROM(   			
			SELECT MAIN_BOARD_SEQ FROM (
				SELECT * 
					FROM MAIN_BOARD 
					WHERE SHOW_DATE = TO_DATE(#{showDate},'YYYY-MM-DD') 
					<if test="arrBoardID != null and arrBoardID != '' ">
						AND BOARD_ID IN
				        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
				            #{type}
				        </foreach>
					</if>
					<if test="boardID != null and boardID != '' ">
						AND BOARD_ID=#{boardID}
					</if>
					<if test="userFlag == 'USER'">
						AND IS_USE = 'Y'
					</if>
					AND MAIN_BOARD_SEQ <![CDATA[>]]> #{mainBoardSeq}
					
			UNION ALL
				SELECT * 
					FROM MAIN_BOARD 
					WHERE SHOW_DATE <![CDATA[>]]> TO_DATE(#{showDate},'YYYY-MM-DD')
					<if test="arrBoardID != null and arrBoardID != '' ">
						AND BOARD_ID IN
				        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
				            #{type}
				        </foreach>
					</if>
					<if test="boardID != null and boardID != '' ">
						AND BOARD_ID=#{boardID}
					</if> 
					<if test="userFlag == 'USER'">
						AND IS_USE = 'Y'
					</if>
			) UN1
			WHERE 1=1		
			<if test="searchText != null and searchText != ''">
				<if test="searchType == ''">
					AND (TITLE LIKE '%'||#{searchText}||'%' OR CONTENTS LIKE '%'||#{searchText}||'%')
				</if>
				<if test="searchType == 's_title'">
					AND (TITLE LIKE '%'||#{searchText}||'%')
				</if>	
				<if test="searchType == 's_contents'">
					AND (CONTENTS LIKE '%'||#{searchText}||'%')
				</if>			
			</if>
			<if test="searchFromDate != null and searchFromDate != ''">
				AND SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
			</if>
			
			<if test="searchToDate != null and searchToDate != ''">
				AND SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
			</if>
			ORDER BY SHOW_DATE ASC, MAIN_BOARD_SEQ ASC
			) X2
		WHERE ROWNUM=1
		))T1		
		
		FULL OUTER JOIN
		
		(SELECT MAIN_BOARD_SEQ AS PRE_MAIN_BOARD_SEQ
			,TITLE AS PRE_TITE
			,'A' AS TEMP_COLUMN
			FROM MAIN_BOARD WHERE MAIN_BOARD_SEQ =
		(
		SELECT MAIN_BOARD_SEQ FROM(
   					
			SELECT MAIN_BOARD_SEQ FROM (
				SELECT * 
					FROM MAIN_BOARD 
					WHERE SHOW_DATE = TO_DATE(#{showDate},'YYYY-MM-DD') 
					<if test="arrBoardID != null and arrBoardID != '' ">
						AND BOARD_ID IN
				        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
				            #{type}
				        </foreach>
					</if>
					<if test="boardID != null and boardID != '' ">
						AND BOARD_ID=#{boardID}
					</if>
					<if test="userFlag == 'USER'">
						AND IS_USE = 'Y'
					</if>
					AND MAIN_BOARD_SEQ <![CDATA[<]]> #{mainBoardSeq}
			UNION ALL
				SELECT * 
					FROM MAIN_BOARD 
					WHERE SHOW_DATE <![CDATA[<]]> TO_DATE(#{showDate},'YYYY-MM-DD')
					<if test="arrBoardID != null and arrBoardID != '' ">
						AND BOARD_ID IN
				        <foreach collection="arrBoardID" item="type"  open="(" close=")" separator=",">
				            #{type}
				        </foreach>
					</if>
					<if test="boardID != null and boardID != '' ">
						AND BOARD_ID=#{boardID}
					</if> 
					<if test="userFlag == 'USER'">
						AND IS_USE = 'Y'
					</if>
			) UN1
			WHERE 1=1		
			<if test="searchText != null and searchText != ''">
				<if test="searchType == ''">
					AND (TITLE LIKE '%'||#{searchText}||'%' OR CONTENTS LIKE '%'||#{searchText}||'%')
				</if>
				<if test="searchType == 's_title'">
					AND (TITLE LIKE '%'||#{searchText}||'%')
				</if>	
				<if test="searchType == 's_contents'">
					AND (CONTENTS LIKE '%'||#{searchText}||'%')
				</if>			
			</if>
			<if test="searchFromDate != null and searchFromDate != ''">
				AND SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
			</if>
			
			<if test="searchToDate != null and searchToDate != ''">
				AND SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
			</if>
			ORDER BY SHOW_DATE DESC, MAIN_BOARD_SEQ DESC
			) X2
		WHERE ROWNUM=1
		))T2
		
		ON T1.TEMP_COLUMN = T2.TEMP_COLUMN
		
	</select>
	
	<select id="selectOneForMainBoardFile"  parameterType="BoardFileVO" resultMap="BoardFileVO">
		SELECT
			MAIN_BOARD_FILE_SEQ
			,MAIN_BOARD_SEQ
			,FILE_TYPE
			,FILE_ORGNM
			,FILE_SAVENM
			,FILE_PATH
			,FILE_SIZE
			,FILE_FORM_NAME      
		FROM MAIN_BOARD_FILE 
		WHERE MAIN_BOARD_SEQ=#{mainBoardSeq}
	</select>
	
	<select id="selectOneForMainBoardFileSeq"  parameterType="BoardFileVO" resultMap="BoardFileVO">
		SELECT
			MAIN_BOARD_FILE_SEQ
			,MAIN_BOARD_SEQ
			,FILE_TYPE
			,FILE_ORGNM
			,FILE_SAVENM
			,FILE_PATH
			,FILE_SIZE
			,FILE_FORM_NAME      
		FROM MAIN_BOARD_FILE 
		WHERE MAIN_BOARD_FILE_SEQ=#{mainBoardFileSeq}
	</select>
	
	<delete id="deleteMainBoard" parameterType="BoardFileVO">
		DELETE FROM MAIN_BOARD WHERE MAIN_BOARD_SEQ=#{mainBoardSeq}
    </delete>
    
	<delete id="deleteMainBoardFile" parameterType="BoardFileVO">
		DELETE FROM MAIN_BOARD_FILE WHERE MAIN_BOARD_SEQ=#{mainBoardSeq}
    </delete>
    
	<delete id="deleteMainBoardFileSeq" parameterType="BoardFileVO">     	
		DELETE FROM MAIN_BOARD_FILE WHERE MAIN_BOARD_FILE_SEQ=#{mainBoardFileSeq}
    </delete>
    
	<update id="updateForMainBoardHitCount" parameterType="BoardVO">
		UPDATE MAIN_BOARD SET
			HIT_COUNT=HIT_COUNT+1			
		WHERE MAIN_BOARD_SEQ = #{mainBoardSeq,jdbcType=INTEGER}
    </update>
    
    <select id="selectCountListForCodeInBoard"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(MAIN_BOARD_SEQ)			
		FROM MAIN_BOARD 
		WHERE BOARD_ID=#{boardID}
		<if test="userFlag == 'USER'">
			AND IS_USE = 'Y'
		</if>
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (TITLE LIKE '%'||#{searchText}||'%' OR CONTENTS LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 's_title'">
				AND (TITLE LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 's_contents'">
				AND (CONTENTS LIKE '%'||#{searchText}||'%')
			</if>			
		</if>
		
		<if test="codeSeq != 0">
			AND (CODE_SEQ = #{codeSeq})
		</if>
		
		<if test="searchFromDate != null and searchFromDate != ''">
			AND SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
		</if>		
	</select>
	
	<select id="selectListForCodeInBoard"  parameterType="SearchVO" resultMap="BoardVO">
	SELECT * FROM (	
		SELECT
			T1.MAIN_BOARD_SEQ
	        ,T1.BOARD_ID
	        ,T1.REG_ID
	        ,T1.HIT_COUNT
	        ,T1.TITLE
	        ,T1.SHOW_DATE
	        ,T1.REG_DATE
	        ,T1.CONTENTS
	        ,T1.IS_USE
	        ,T1.CODE_SEQ
	        ,T2.CODE_NAME
			,ROW_NUMBER() OVER( ORDER BY T1.SHOW_DATE DESC, T1.MAIN_BOARD_SEQ DESC) AS RNUM
		FROM MAIN_BOARD T1
			LEFT OUTER JOIN COMMCODE T2
			ON T1.CODE_SEQ = T2.CODE_SEQ
		WHERE BOARD_ID=#{boardID}
		<if test="userFlag == 'USER'">
			AND T1.IS_USE = 'Y'
		</if>
		<if test="searchText != null and searchText != ''">
			<if test="searchType == ''">
				AND (T1.TITLE LIKE '%'||#{searchText}||'%' OR T1.CONTENTS LIKE '%'||#{searchText}||'%')
			</if>
			<if test="searchType == 's_title'">
				AND (T1.TITLE LIKE '%'||#{searchText}||'%')
			</if>	
			<if test="searchType == 's_contents'">
				AND (T1.CONTENTS LIKE '%'||#{searchText}||'%')
			</if>			
		</if>
		<if test="codeSeq != 0">
			AND (T1.CODE_SEQ = #{codeSeq})
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND T1.SHOW_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND T1.SHOW_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate},'YYYY-MM-DD')
		</if>
		)T WHERE 
				RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
	</select>
    
    
    
</mapper>