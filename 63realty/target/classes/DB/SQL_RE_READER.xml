<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="reReader"> 
	<resultMap id="ReReaderVO" type="kr.co.realty.data.reReader.vo.ReReaderVO">
	<result property="reReaderSeq"			column="RE_READER_SEQ"/>
	<result property="email"					column="EMAIL"/>
	<result property="readerName"			column="READER_NAME"/>
	<result property="readerTeam"			column="READER_TEAM"/>
	<result property="readerPhone"			column="READER_PHONE"/>
	<result property="regDate"				column="REG_DATE"/>
	<result property="cancelDate"			column="CANCEL_DATE"/>
	<result property="cancelName"			column="CANCEL_NAME"/>
	<result property="ip"							column="IP"/>
	<result property="userFlag"				column="USER_FLAG"/>
 	</resultMap>
 	
 	<select id="selectCountOneForReReader" parameterType="ReReaderVO" resultType="integer">
 		SELECT COUNT(RE_READER_SEQ)
 		FROM RE_READER
 		WHERE USER_FLAG = 'Y' AND EMAIL=#{email}
 	</select>
 	
 	<insert id="insertReReader" parameterType="ReReaderVO">
 		INSERT INTO
 			RE_READER(
 				RE_READER_SEQ
 				,EMAIL
 				,READER_NAME
 				,READER_TEAM
 				,READER_PHONE
 				,REG_DATE
 				,IP
 				,USER_FLAG
 			)VALUES(
 				RE_READER_T_SEQ.NEXTVAL
 				,#{email,jdbcType=VARCHAR}
 				,#{readerName,jdbcType=VARCHAR}
 				,#{readerTeam,jdbcType=VARCHAR}
 				,#{readerPhone,jdbcType=VARCHAR}
 				,SYSDATE
 				,#{ip,jdbcType=VARCHAR}
 				,#{userFlag,jdbcType=VARCHAR}
 			)
 	</insert>
 	
 	<update id="updateCancelForReReader" parameterType="ReReaderVO">
 		UPDATE RE_READER SET 			
 			CANCEL_DATE = SYSDATE
 			,CANCEL_NAME = #{cancelName,jdbcType=VARCHAR}
 			,USER_FLAG = #{userFlag,jdbcType=VARCHAR}
 		WHERE USER_FLAG = 'Y'
			AND EMAIL = #{email,jdbcType=VARCHAR}
 	</update>
 	
 	<select id="selectCountListForReReader"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(RE_READER_SEQ)			
		FROM RE_READER 
		WHERE 1=1		
		<if test="userFlag != null and userFlag != ''">
			AND USER_FLAG = #{userFlag}
		</if>
		<if test="searchText != null and searchText != ''">
			AND EMAIL LIKE '%'||#{searchText}||'%'
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND REG_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND REG_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate}||' 23:59:59','YYYY-MM-DD hh24:mi:ss')
		</if>
	</select>
	
	<select id="selectListForReReader"  parameterType="SearchVO" resultMap="ReReaderVO">
	SELECT * FROM (	
		SELECT
			T1.RE_READER_SEQ
	        ,T1.EMAIL
	        ,T1.READER_NAME
	        ,T1.READER_TEAM
	        ,T1.READER_PHONE
	        ,T1.REG_DATE
	        ,T1.CANCEL_DATE
	        ,T1.CANCEL_NAME
	        ,T1.IP
	        ,T1.USER_FLAG	      
			,ROW_NUMBER() OVER( ORDER BY T1.REG_DATE DESC) AS RNUM
		FROM RE_READER T1			
		WHERE 1=1
		<if test="userFlag != null and userFlag != ''">
			AND T1.USER_FLAG = #{userFlag}
		</if>
		<if test="searchText != null and searchText != ''">
			AND T1.EMAIL LIKE '%'||#{searchText}||'%'
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND T1.REG_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>
		
		<if test="searchToDate != null and searchToDate != ''">
			AND T1.REG_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate}||' 23:59:59','YYYY-MM-DD hh24:mi:ss')
		</if>
		)T WHERE 
				RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
	</select>
	<select id="selectListForReReaderExcel"  parameterType="SearchVO" resultMap="ReReaderVO">	
		SELECT
			T1.RE_READER_SEQ
	        ,T1.EMAIL
	        ,T1.READER_NAME
	        ,T1.READER_TEAM
	        ,T1.READER_PHONE
	        ,T1.REG_DATE
	        ,T1.CANCEL_DATE
	        ,T1.CANCEL_NAME
	        ,T1.IP
	        ,T1.USER_FLAG
		FROM RE_READER T1			
		WHERE 1=1
		<if test="userFlag != null and userFlag != ''">
			AND T1.USER_FLAG = #{userFlag}
		</if>
		<if test="searchText != null and searchText != ''">
			AND T1.EMAIL LIKE '%'||#{searchText}||'%'
		</if>
		<if test="searchFromDate != null and searchFromDate != ''">
			AND T1.REG_DATE <![CDATA[>=]]> TO_DATE(#{searchFromDate},'YYYY-MM-DD')
		</if>		
		<if test="searchToDate != null and searchToDate != ''">
			AND T1.REG_DATE <![CDATA[<=]]> TO_DATE(#{searchToDate}||' 23:59:59','YYYY-MM-DD hh24:mi:ss')
		</if>
		ORDER BY T1.REG_DATE DESC
	</select>
     	
</mapper>