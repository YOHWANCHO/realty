<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="greenhouse">
	<resultMap id="GreenHouseVO" type="kr.co.realty.data.greenhouse.vo.GreenHouseVO">
		<result property = "grYear"	column="GR_YEAR"/>
		<result property = "colPlace"	column="COL_PLACE"/>
		<result property = "firstQ"		column="FIRST_Q"/>
		<result property = "secondQ"	column="SECOND_Q"/>
		<result property = "thirdQ"		column="THIRD_Q"/>
		<result property = "fourthQ"	column="FOURTH_Q"/>
		<result property = "grDesc"	column="GR_DESC"/>
		<result property = "grOrder"	column="GR_ORDER"/>
		<result property = "grFlag"		column="GR_FLAG"/>
		<result property = "regDate"	column="REG_DATE"/>
		<result property = "regName"	column="REG_NAME"/>
		<result property = "regID"		column="REG_ID"/>
	</resultMap>

	<select id="selectCountListForGreenHouse"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(GR_YEAR)			
		FROM (SELECT GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD') AS REG_DATE FROM GREEN_HOUSE GROUP BY GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD'))		
		WHERE 1=1		
		<if test="userFlag == 'USER'">
			AND IS_USE = 'Y'
		</if>
	</select>
	
	<select id="selectCountOneForGreenHouse"  parameterType="SearchVO" resultType="integer">	
		SELECT
			COUNT(GR_YEAR)			
		FROM (SELECT GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD') AS REG_DATE FROM GREEN_HOUSE GROUP BY GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD'))
		WHERE GR_YEAR = #{grYear,jdbcType=INTEGER}
	</select>
	
	<select id="selectListForGreenHouse"  parameterType="SearchVO" resultMap="GreenHouseVO">
	SELECT * FROM (	
		SELECT
			T1.GR_YEAR
	        ,T1.REG_ID
	        ,T1.REG_DATE	        
	        ,T2.ADM_NAME as REG_NAME
			,ROW_NUMBER() OVER( ORDER BY T1.GR_YEAR DESC) AS RNUM
		FROM (SELECT GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD') AS REG_DATE FROM GREEN_HOUSE GROUP BY GR_YEAR, REG_ID, TO_CHAR(REG_DATE,'YYYY-MM-DD')) T1
			LEFT OUTER JOIN ADM_MEMBER T2
			ON T1.REG_ID = T2.ADM_ID
		WHERE 1=1
		<if test="userFlag == 'USER'">
			AND IS_USE = 'Y'
		</if>		
		)T WHERE 
				RNUM BETWEEN ((#{pageIndex}-1) * #{pageCount}) + 1 AND ((#{pageIndex}-1) * #{pageCount}) + #{pageCount}
	</select>
	
	<select id="selectListForOneGreenHouse"  parameterType="GreenHouseVO" resultMap="GreenHouseVO">
		SELECT
			GR_YEAR			
			, COL_PLACE
			, FIRST_Q
			, SECOND_Q
			, THIRD_Q
			, FOURTH_Q
			, GR_FLAG
			, GR_ORDER
			, GR_DESC
		FROM GREEN_HOUSE
		WHERE GR_YEAR=#{grYear}
		ORDER BY GR_FLAG, GR_ORDER
	</select>
	
	<select id="selectListForYearGreenHouse"  parameterType="GreenHouseVO" resultMap="GreenHouseVO">
		SELECT
			GR_YEAR
		FROM GREEN_HOUSE		
		GROUP BY GR_YEAR
		ORDER BY GR_YEAR DESC		
	</select>
	
	<insert id="insertGreenHouse" parameterType="GreenHouseVO">
          INSERT INTO 
          	GREEN_HOUSE ( 
				GR_YEAR
				, COL_PLACE
				, FIRST_Q
				, SECOND_Q
				, THIRD_Q
				, FOURTH_Q
				, GR_DESC
				, GR_ORDER
				, GR_FLAG
				, REG_DATE				
				, REG_ID
          ) VALUES (
				#{grYear,jdbcType=INTEGER}
				, #{colPlace,jdbcType=VARCHAR}
				, #{firstQ,jdbcType=VARCHAR}
				, #{secondQ,jdbcType=VARCHAR}
				, #{thirdQ,jdbcType=VARCHAR}
				, #{fourthQ,jdbcType=VARCHAR}
				, #{grDesc,jdbcType=VARCHAR}
				, #{grOrder,jdbcType=INTEGER}
				, #{grFlag,jdbcType=INTEGER}
				, SYSDATE
				, #{regID,jdbcType=VARCHAR}
          )
    </insert>
    
    <delete id="deleteGreenHouse" parameterType="GreenHouseVO">
		DELETE FROM GREEN_HOUSE WHERE GR_YEAR=#{grYear,jdbcType=INTEGER}
    </delete>
    
</mapper>