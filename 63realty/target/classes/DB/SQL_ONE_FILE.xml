<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="oneFile"> 
	<resultMap id="OneFileVO" type="kr.co.realty.data.oneFile.vo.OneFileVO">
	     <result property="boardID" column="BOARD_ID"/>
	     <result property="regID" column="REG_ID"/>
	     <result property="regDate" column="REG_DATE"/>
	     <result property="regName" column="REG_NAME"/>
	     <result property="updateID" column="UPDATE_ID"/>
	     <result property="updateDate" column="UPDATE_DATE"/>
	     <result property="updateName" column="UPDATE_NAME"/>
	     <result property="fileType" column="FILE_TYPE"/>
	     <result property="fileOrgnm" column="FILE_ORGNM"/>
	     <result property="fileSavenm" column="FILE_SAVENM"/>
	     <result property="filePath" column="FILE_PATH"/>
	     <result property="fileSize" column="FILE_SIZE"/>	     
	     <result property="fileFormName" column="FILE_FORM_NAME"/>
 	</resultMap>
 	
 	<select id="selectOneFile" parameterType="OneFileVO"  resultMap="OneFileVO">		
		SELECT
			A.BOARD_ID
			,A.REG_ID
			,A.REG_DATE
			,T1.ADM_NAME AS REG_NAME
			,A.UPDATE_ID
			,A.UPDATE_DATE
			,T2.ADM_NAME AS UPDATE_NAME
			,A.FILE_TYPE
			,A.FILE_ORGNM
			,A.FILE_SAVENM
			,A.FILE_PATH
			,A.FILE_SIZE		
			,A.FILE_FORM_NAME
		FROM
			E_ONE_FILE A
			LEFT OUTER JOIN ADM_MEMBER T1 ON A.REG_ID = T1.ADM_ID 
			LEFT OUTER JOIN ADM_MEMBER T2 ON A.REG_ID = T2.ADM_ID 
		WHERE 
			A.BOARD_ID=#{boardID}
	</select>
	
<!--  	<select id="selectListOneFile" parameterType="OneFileVO"  resultMap="OneFileVO">		 -->
<!-- 		SELECT -->
<!-- 			A.BOARD_ID -->
<!-- 			,A.REG_ID -->
<!-- 			,A.REG_DATE -->
<!-- 			,A.REG_NAME -->
<!-- 			,A.UPDATE_ID -->
<!-- 			,A.UPDATE_DATE -->
<!-- 			,A.UPDATE_NAME -->
<!-- 			,A.FILE_TYPE -->
<!-- 			,A.FILE_ORGNM -->
<!-- 			,A.FILE_SAVENM -->
<!-- 			,A.FILE_PATH -->
<!-- 			,A.FILE_SIZE		 -->
<!-- 			,A.FILE_FORM_NAME -->
<!-- 		FROM -->
<!-- 			E_ONE_FILE A -->
<!-- 			LEFT OUTER JOIN ADM_MEMBER T1 ON A.REG_ID = T1.ADM_ID  -->
<!-- 			LEFT OUTER JOIN ADM_MEMBER T2 ON A.REG_ID = T2.ADM_ID  -->
<!-- 		WHERE  -->
<!-- 			BOARD_ID=#{boardID}							 -->
<!-- 	</select> -->
	
	<update id="mergeOneFile" parameterType="OneFileVO" >
        <![CDATA[
        MERGE INTO E_ONE_FILE  a
            USING DUAL ON (a.BOARD_ID=#{boardID})
             WHEN MATCHED THEN
             UPDATE SET
                 a.UPDATE_ID=#{regID}
                 ,a.UPDATE_DATE=SYSDATE
                 ,a.FILE_TYPE=#{fileType ,jdbcType=VARCHAR}
                 ,a.FILE_ORGNM=#{fileOrgnm ,jdbcType=VARCHAR}
                 ,a.FILE_SAVENM=#{fileSavenm ,jdbcType=VARCHAR}
                 ,a.FILE_PATH=#{filePath ,jdbcType=VARCHAR}
                 ,a.FILE_SIZE=#{fileSize ,jdbcType=VARCHAR}                
                 ,FILE_FORM_NAME = #{fileFormName ,jdbcType=VARCHAR}
              WHEN NOT MATCHED THEN
                INSERT ( 
                              a.BOARD_ID, 
                              a.REG_ID, 
                              a.REG_DATE,
                              a.FILE_TYPE,
                              a.FILE_ORGNM,
                              a.FILE_SAVENM,
                              a.FILE_PATH,
                              a.FILE_SIZE,                              
                              FILE_FORM_NAME
                        ) 
                VALUES (		
                				#{boardID}
                               ,#{regID}
                               ,SYSDATE
                               ,#{fileType ,jdbcType=VARCHAR}                               
                               ,#{fileOrgnm ,jdbcType=VARCHAR}
                               ,#{fileSavenm ,jdbcType=VARCHAR}
                               ,#{filePath ,jdbcType=VARCHAR}
                               ,#{fileSize ,jdbcType=VARCHAR}                                  
                               ,#{fileFormName ,jdbcType=VARCHAR}                            
                        )
          ]]>
    </update>
    
	<delete id="deleteOneFile" parameterType="OneFileVO" >
		DELETE FROM E_ONE_FILE WHERE BOARD_ID=#{boardID} AND FILE_FORM_NAME = #{fileFormName}
    </delete>   
     	
</mapper> 


